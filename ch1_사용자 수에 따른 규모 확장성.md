사용자 수에 따른 규모 확장성
=

단순한 구조의 단일 서버의 시스템 구성 예시
-
1. 사용자는 도메인 이름을 이용하여 웹사이트에 접속(DNS를 사용해 우리가 익숙한 www.****.com의 형식의 도메인 이름을 IP주소로 변환한다)
2. IP 주소로 HTTP 요청을 전달한다
3. 요청받은 웹서버는 응답(HTML, JSON 등)을 반환한다

> 소통은 HTTP 프로토콜을 통해!

데이터베이스
-
사용자가 늘면 웹/모바일 트래픽 처리 용도 이외에 목적에 따라 서버를 확장해야 한다.
대표적인 예시는 데이터베이스를 위한 서버이다.

1. RDBM
2. NoSQL
   1. 키-값 저장소
   2. 그래프 저장소, 예: [그래프 데이터 베이스](https://bitnine.tistory.com/509?category=910749)
   3. 칼럼 저장소: 예: [칼럼 데이터 베이스](https://appmaster.io/ko/glossary/kalreomhyeong-jeojangso)
   4. 문서 저장소

> NoSQL을 고려해 볼법한 상황
> 1. 낮은 지연시간이 요구됨
> 2. 다루는 데이터가 비정형이라 관계형 데이터가 아님 (생각! 비정형의 기준이 무엇일지?)
> 3. 데이터를 직렬화 역직렬화만 할 수 있다면 충분함
> 4. 아주 많은 양의 데이터를 저장할 필요가 있음

수직적 확장/수평적 확장
-
서버로 유입되는 트래픽이 적다면 수직적 확장이 좋은 옵션이다.
수직적 확장은 단순하다는 장점이 있다.
하지만 성능적 한계와 복구, 다중화, 비용 등의 어려움이 있다.

로드 밸런서
-
부하 분산 집합에 속한 웹 서버들에게 트래픽 부하를 고르게 분산하는 역할이다.
사용자는 로드밸런서의 공개 IP주소를 통해 접속하고 로드밸런서는 사설 IP주소를 사용해 웹 서버와 통신한다.

성능적 한계와 복구, 다중화 등에 도움을 줄 수 있다.

데이터베이스 다중화
-
마스터-슬레이브 서버를 가지고 데이터 원본은 마스터 서버에 사본은 슬레이브 서버에 저장하는 방식이다.
일반적으로 쓰기 연산은 마스터에서만 지원한다. 

마찬가지로 성능, 안정성, 가용성 면에서 이득을 가져갈 수 있다.
예를 들면 다음과 같은 플로우를 생각할 수 있다.

1. 주 서버가 다운된다면 부 서버가 새로운 주 서버가 된다.
2. 없는 데이터에 대한 복구 스크립트를 돌린다.

캐시
-
값 비산 연산 결과 혹은 자주 참조되는 데이터를 메모리 안에 두고, 뒤이은 요청이 보다 빨리 처리될 수 있도록 하는 저장소이다.

아래와 같은 경우를 고려해봄직하다.

1. 데이터 변경이 드물고 조회가 빈번한 경우
2. 휘발성 메모리
3. 만료기한에 대한 적절한 합의점
4. 일관성에 대한 적절한 합의점
5. 캐시 서버 역시 SPOF를 피하기 위해 다중화 전략을 생각하는 것이 좋다.
6. 메모리의 크기에 대한 적절한 합의점
7. 데이터 방출 정책에 대한 적절한 합의점

콘텐츠 전송 네트워크(CDN)
-
CDN은 정적 콘텐츠를 전송하는 데 쓰이는 지리저으로 분산된 서비의 네트워크이다.
이미지, 비디오, CSS, JS등의 파일을 캐시할 수 있다.

어떤 사용자가 웹사이트를 방문하면 그 사용자에게 가장 가까운 CDN 서버가 정적 콘텐츠를 전달하게 된다.

아래와 같은 경우를 고려해봄직하다.

1. 비용
2. TTL
3. 장애에 대한 대처 사항
4. 콘텐츠 무효화 방법 (플랫폼 제공 API 혹은 오브젝트 버저닝 등의 방법)


무상태 웹계층
-
사용자의 상태를 서버가 일대일로 들고 있는 경우에는 확장에도 불리하거니와, 로드밸런서가 고정 세션을 지원하기 위해 추가적 부담이 발생한다.
무상태 웹계층은 사용자로부터의 HTTP요청을 어떤 웹 서버로도 전달할 수 있으며, 웹서버는 상태정보가 필요한 경우 공유 저장소로부터 데이터를 가져온다.
즉, 상태정보는 웹 서버로부터 물리적으로 분리되어 있다. 단순하고 안정적이고 규모 확장이 쉽다.

데이터 센터
-
장애가 없는 상황이라면 통상 사용자는 가장 가까운 데이터 센터로 안내된다.
이와 같이 다수의 데이터센터를 운용하면 장애에도 손쉬운 대응이 가능하다.

다음은 데이터 센터를 운용할 때 고려할 요소이다.

1. 트래픽 우회: 올바른 센터로 보내는 효율적인 방법을 생각해야 한다.
2. 데이터 동기화: 센터마다 데이터의 싱크를 관리하는 방법에 대해 생각해야 한다.
3. 테스트와 배포

메시지 큐
-

> pub -> q -> sub

메시지 큐는 무손실을 보장하는 비동기 통신을 지원하는 컴포넌트이다.
메시지의 버퍼 역할을 하며, 비동기적으로 전송한다.
느슨한 결합과 규모 확장성이 보장되어야 하는 안정적 어플리케이션을 구성하기 좋다.

로그, 메트릭 그리고 자동화
-
...

데이터베이스의 규모 확장
-

1. 수직적 확장
2. 수평적 확장(샤딩): 데이터 베이스를 샤드라고 하는 작은 단위로 분할하는 기술. 모든 샤드는 같은 스키마를 쓰지만 샤드에 저장되는 데이터의 중복은 없다.

샤딩 전략을 구성할 때, 고려해야할 중요한 요소는 샤딩 키(파티션 키)를 어떻게 정하느냐이다.
데이터가 어떻게 분산될지 정하는 하나 이상의 칼럼으로 구성된다.
샤딩 키를 선택할 때에는 균등하게 데이터를 분포시킬 수 있는지를 고려해야한다.

다만 샤딩을 도입하면 다음과 같은 문제를 고려해야한다.

1. 데이터의 재샤딩: 데이터가 너무 많아지거나, 데이터 분포가 고르지 못해 하나의 샤드에 몰림 현상이 발생하는 경우
2. 유명인사 문제: 핫스팟 키 문제라고도 불리우며, 특정 샤드에 질의가 몰리는 문제
3. 조인과 비정규화: 데이터 베이스를 여러 샤드로 쪼개면 조인이 어려워진다. 이를 해결하기 위해 비정규화도 고려해봄직하다
