유튜브 설계
=

비디오 업로드 절차
-

1. 비디오 원본 저장소에 업로드
2. 트랜스코딩 서버는 원본 저장소에서 해당 비디오를 가져와 트랜스코딩을
시작
3. 트랜스코딩 비디오 저장소 업로드/메타데이터 저장소 & 캐시 업데이트/API서버에 준비 완료 알림


1. 비디오 메타데이터(파일 이름, 크기, 포맷 등) 갱신

다음의 컴포넌트들로 구성되어 있다.

- 사용자: 컴퓨터나 모바일 폰, 혹은 스마트 TV를 통해 유튜브를 시청하는 이용자다.
- 로드밸런서: API 서버 각각으로 고르게 요청을 분산하는 역할을 담당한다.
- API 서버: 비디오 스트리밍을 제외한 다른 모든 요청을 처리한다.
- 메타데이터 데이커베이스 & 캐시: 비디오 메타데이터 와 사용자 객체를 저장한다
- 원본 저장소: 원본 비디오를 보관할 대형 이진 파일 저장소 (BLOB, 즉 Binary Large Object storage) 시스템이다.
- 트랜스코딩 서버: **비디오의 포맷(MPEG, HLS 등)을 변환**하는 절차. 단말이나 대역폭 요구사항에 맞는 최적의 비디오 스트림을 제공하기 위해 필요하다.
- 트랜스코딩 비디오 저장소: 트랜스코딩이 완료된 비디오를 저장하는 BLOB 저장소다.
- CDN: 비디오를 캐시하는 역할을 담당. 사용자가 재생 버튼을 누르면 비디오 스트리밍은 CDN을 통해 이루어진다.

비디오 스트리밍 절차
-

비디오는 CDN에서 바로 호출된다.

**스트리밍 프로토콜**
- 비디오 스트리밍을 위해 데이터를 전송할 때 쓰이는 표준
- 프로토콜마다 지원하는 비디오 인코딩이 다르고 플레이어도 다르다

비디오 트랜스코딩
-
특정 포맷의 비디오가 다른 포맷과 호환이 되도록 비트레이트 포맷으로 저장되어야 한다.
비트레이트 포맷은 비트가 처리되는 속도를 나타낸 것으로 높을수록 고화질이다.

가공이 되지 않은 원본은 많은 저장공간을 차지하고, 사용자/네트워크 상황에 따라 유연한 대응을 하기 위한 목적으로도 중요하다.
따라서 각기 다른 유형의 비디오 프로세싱 파이프라인을 지원할 수 있어야한다.

Directed Acyclic Graph
-
비디오 트랜스코딩의 작업이 유연하고, 병렬적이게 실행될 수 있게 돕는 방법의 하나

**다양한 비디오 작업의 예시**
- 검사: 좋은 품질의 비디오인지, 손상은 없는지 확인하는 작업
- 비디오 인코딩: 비디오를 다양한 해상도, 코덱, 비트레이트 조합으로 인코딩하는 작업
- 썸네일: 사용자가 업로드한 이미지나 비디오에서 자동 추출된 이미지 썸네일을 만드는 작업
- 워터마크: 비디오에 대한 식별정보를 이미지 위에 오버레이 형태로 띄워 표시하는 작업

처리 과정의 병렬성을 높이기 위해서는 적절한 수준의 추상화를 도입하여 클라이언트 프로그래머로 하여금 실행할 작업을 손수 정의할 수 있도록 해야 한다.
다섯 개의 주요 컴포넌트로 구성할 수 있다.

- 전처리기(preprocessor): 비디오 분할, DAG 생성, 데이터 캐시 등의 역할
- DAG 스케줄러: 
- 자원 관리자(resource manager): 어떤 작업을 어떤 서버에 할당할지를 결정하고 실행까지 관리
- 작업 실행 서버(resource worker)
- 임시 저장소(temporary storage)

시스템 최적화
-
- 작은 GOP 단위로 업로드
- 업로드 센터를 사용자 근거리에 지정
- 병렬화

- presigned URL
- 비디오 저작권 관리

- CDN 최적화

오류 처리
-
- 회복 가능한 오류: 재시도
- 회복 불가능한 오류
